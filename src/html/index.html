<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script>
      const initFacebookPixel = (id) => {
        !(function (f, b, e, v, n, t, s) {
          if (f.fbq) return;
          n = f.fbq = function () {
            n.callMethod
              ? n.callMethod.apply(n, arguments)
              : n.queue.push(arguments);
          };
          if (!f._fbq) f._fbq = n;
          n.push = n;
          n.loaded = !0;
          n.version = "2.0";
          n.queue = [];
          t = b.createElement(e);
          t.async = !0;
          t.src = v;
          s = b.getElementsByTagName(e)[0];
          s.parentNode.insertBefore(t, s);
        })(
          window,
          document,
          "script",
          "https://connect.facebook.net/en_US/fbevents.js"
        );
        const fbPixelId = id;
        fbq("init", fbPixelId);
        window.fbPixelId = fbPixelId;
        window.fbcFunc = fbq;
      };

      const initGTM = (id) => {
        (function (w, d, s, l, i) {
          w[l] = w[l] || [];
          w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
          var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
          j.async = true;
          j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
          f.parentNode.insertBefore(j, f);
        })(window, document, "script", "dataLayer", id);
      };

      const initVolumScript = (url) => {
        (function (b, c, l, q, r, e, t, y, d, m, u, z, a, n, g, f, p, v, h, w) {
          function x() {
            for (
              var a = c.querySelectorAll(".dtpcnt"), b = 0, d = a.length;
              b < d;
              b++
            )
              a[b][t] = a[b][t].replace(/(^|\s+)dtpcnt($|\s+)/g, "");
          }
          w = "https:" === b.location.protocol ? "secure; " : "";
          b[d] ||
            ((b[d] = function () {
              (b[d].q = b[d].q || []).push(arguments);
            }),
            (g = c[q]),
            (c[q] = function () {
              g && g.apply(this, arguments);
              if (
                b[d] &&
                !b[d].hasOwnProperty("params") &&
                /loaded|interactive|complete/.test(c.readyState)
              )
                for (; (a = c[r][m++]); )
                  /\/?click\/?($|(\/[0-9]+)?$)/.test(a.pathname) &&
                    (a[e] =
                      "javascrip" +
                      b.postMessage.toString().slice(4, 5) +
                      ":" +
                      d +
                      '.l="' +
                      a[e] +
                      '",void 0');
            }),
            setTimeout(function () {
              (p = /[?&]cpid(=([^&#]*)|&|#|$)/.exec(b.location.href)) &&
                p[2] &&
                ((f = p[2]),
                (v = c.cookie.match(new RegExp("(^| )vl-" + f + "=([^;]+)"))));
              var d = c.cookie.match(/(^| )vl-cep=([^;]+)/),
                k = location[e];
              if (
                "savedCep" === z &&
                d &&
                (!f || "undefined" === typeof f) &&
                0 > k.indexOf("cep=")
              ) {
                var g = -1 < k.indexOf("?") ? "&" : "?";
                k += g + d.pop();
              }
              a = c.createElement("script");
              n = c.scripts[0];
              a.defer = 1;
              a.src =
                u +
                (-1 === u.indexOf("?") ? "?" : "&") +
                "lpref=" +
                l(c.referrer) +
                "&lpurl=" +
                l(k) +
                "&lpt=" +
                l(c.title) +
                "&vtm=" +
                new Date().getTime() +
                (v ? "&uw=no" : "");
              a[y] = function () {
                for (m = 0; (a = c[r][m++]); )
                  /dtpCallback\.l/.test(a[e]) &&
                    (a[e] = decodeURIComponent(a[e]).match(
                      /dtpCallback\.l="([^"]+)/
                    )[1]);
                x();
              };
              n.parentNode.insertBefore(a, n);
              f &&
                ((h = new Date()),
                h.setTime(h.getTime() + 864e5),
                (c.cookie =
                  "vl-" +
                  f +
                  "=1; " +
                  w +
                  "samesite=Strict; expires=" +
                  h.toGMTString() +
                  "; path=/"));
            }, 0),
            setTimeout(x, 7e3));
        })(
          window,
          document,
          encodeURIComponent,
          "onreadystatechange",
          "links",
          "href",
          "className",
          "onerror",
          "dtpCallback",
          0,
          url,
          "savedCep"
        );
        var clickId;
        window.dtpCallback(() => {
          clickId = window.dtpCallback.params.click_id;
          sessionStorage.setItem("clickId", clickId);
        });
      };

      const initTikTok = (pixelId) => {
        var queryString = window.location.search;
        var params = new URLSearchParams(queryString);
        var utm_source = params.get("utm_source");

        if (utm_source === "tiktok") {
          !(function (w, d, t) {
            w.TiktokAnalyticsObject = t;
            var ttq = (w[t] = w[t] || []);
            (ttq.methods = [
              "page",
              "track",
              "identify",
              "instances",
              "debug",
              "on",
              "off",
              "once",
              "ready",
              "alias",
              "group",
              "enableCookie",
              "disableCookie",
            ]),
              (ttq.setAndDefer = function (t, e) {
                t[e] = function () {
                  t.push([e].concat(Array.prototype.slice.call(arguments, 0)));
                };
              });
            for (var i = 0; i < ttq.methods.length; i++)
              ttq.setAndDefer(ttq, ttq.methods[i]);
            (ttq.instance = function (t) {
              for (var e = ttq._i[t] || [], n = 0; n < ttq.methods.length; n++)
                ttq.setAndDefer(e, ttq.methods[n]);
              return e;
            }),
              (ttq.load = function (e, n) {
                var i = "https://analytics.tiktok.com/i18n/pixel/events.js";
                (ttq._i = ttq._i || {}),
                  (ttq._i[e] = []),
                  (ttq._i[e]._u = i),
                  (ttq._t = ttq._t || {}),
                  (ttq._t[e] = +new Date()),
                  (ttq._o = ttq._o || {}),
                  (ttq._o[e] = n || {});
                var o = document.createElement("script");
                (o.type = "text/javascript"),
                  (o.async = !0),
                  (o.src = i + "?sdkid=" + e + "&lib=" + t);
                var a = document.getElementsByTagName("script")[0];
                a.parentNode.insertBefore(o, a);
              });
            ttq.load(pixelId);
            ttq.page();
          })(window, document, "ttq");
          window.tikTokPixel = pixelId;
          window.tikTokEvent = ttq;
        }
      };

      const initNoScripts = () => {
        const element = window.document.getElementById("noscripts");
        element.innerHTML = `
            <noscript
              ><iframe
                src="https://www.googletagmanager.com/ns.html?id=${window.domain_settings.gtm}"
                height="0"
                width="0"
                style="display: none; visibility: hidden"
              ></iframe
            ></noscript>

            <noscript
              ><img
                height="1"
                width="1"
                style="display: none"
                src="https://www.facebook.com/tr?id=${window.domain_settings.facebookPixel}&ev=PageView&noscript=1"
            /></noscript>

            <noscript>
              <link
                href="${window.domain_settings.volumUrl}"
                rel="stylesheet"
              />
            </noscript>
      `;
      };

      const initScripts = (domain_settings) => {
        const domain = window.location.hostname;
        console.log("Domain Name", domain);
        const currentDomainSettings = domain_settings.find((i) => {
          return i.name.includes(domain);
        });
        window.domain_settings = currentDomainSettings;
        console.log("CurrentDomainSetting", currentDomainSettings);
        console.log("CurrentDomainSetting2", domain,domain_settings);
        if(window.domain_settings){
          initFacebookPixel(currentDomainSettings.facebookPixel);
          initGTM(currentDomainSettings.gtm);
          initVolumScript(currentDomainSettings.volumUrl);
          initTikTok(currentDomainSettings.tikTok);
          initNoScripts();
        }

        window.document.title = currentDomainSettings.websiteTitle;
      };

      fetch(
        "https://raw.githubusercontent.com/nikhilwecall/wecallcms/main/json_data/domain_settings.json"
      )
        .then((response) => response.json())
        .then((data) => initScripts(data));
    </script>
    <title>Lander</title>
  </head>

  <body>
    <div id="root"></div>
    <div id="noscripts"></div>
  </body>
</html>
